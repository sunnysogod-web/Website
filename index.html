<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>р╕гр╕░р╕Ър╕Ър╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Prompt', sans-serif;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
    
    @keyframes bounce-slow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    
    @keyframes leaf-sway {
      0%, 100% { transform: rotate(-5deg) translateX(0); }
      50% { transform: rotate(5deg) translateX(5px); }
    }
    
    @keyframes cloud-move {
      0% { transform: translateX(-10px); }
      100% { transform: translateX(10px); }
    }
    
    .float-animation { animation: float 3s ease-in-out infinite; }
    .wiggle-animation { animation: wiggle 2s ease-in-out infinite; }
    .bounce-animation { animation: bounce-slow 2s ease-in-out infinite; }
    .leaf-animation { animation: leaf-sway 4s ease-in-out infinite; }
    .cloud-animation { animation: cloud-move 6s ease-in-out infinite alternate; }
    
    .notification-badge {
      position: relative;
    }
    
    .notification-badge::after {
      content: '';
      position: absolute;
      top: -2px;
      right: -2px;
      width: 12px;
      height: 12px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse-ring 1.5s ease-out infinite;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .gradient-border {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 3px;
      border-radius: 1rem;
    }
    
    .gradient-border > div {
      background: white;
      border-radius: calc(1rem - 3px);
    }
    
    .school-pattern {
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(120, 200, 120, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(100, 180, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 200, 100, 0.05) 0%, transparent 30%);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      ring: 2px;
      ring-color: #667eea;
    }
    
    .cute-shadow {
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.15), 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .status-pending { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
    .status-approved { background: linear-gradient(135deg, #34d399 0%, #10b981 100%); }
    .status-rejected { background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-green-50 via-blue-50 to-purple-50 school-pattern overflow-auto">
  <div id="app" class="min-h-full w-full">
    
    <!-- Decorative Elements -->
    <div class="fixed top-10 left-10 text-6xl float-animation opacity-60 pointer-events-none z-0">ЁЯМ│</div>
    <div class="fixed top-20 right-20 text-5xl wiggle-animation opacity-60 pointer-events-none z-0">ЁЯМ╕</div>
    <div class="fixed bottom-20 left-20 text-4xl bounce-animation opacity-60 pointer-events-none z-0">ЁЯУЪ</div>
    <div class="fixed bottom-10 right-10 text-5xl leaf-animation opacity-60 pointer-events-none z-0">ЁЯНГ</div>
    <div class="fixed top-40 left-1/4 text-3xl cloud-animation opacity-40 pointer-events-none z-0">тШБя╕П</div>
    <div class="fixed top-60 right-1/4 text-4xl cloud-animation opacity-40 pointer-events-none z-0" style="animation-delay: 2s;">тШБя╕П</div>
    
    <!-- Login Page - Student -->
    <div id="loginPage" class="min-h-full w-full flex items-center justify-center p-4 relative z-10">
      <div class="w-full max-w-md">
        <div class="gradient-border cute-shadow">
          <div class="p-8">
            <!-- Cute Student Character -->
            <div class="text-center mb-6">
              <div class="text-8xl mb-2 float-animation">ЁЯСитАНЁЯОУ</div>
              <div class="flex justify-center gap-2 text-2xl">
                <span class="wiggle-animation" style="animation-delay: 0.1s;">ЁЯОТ</span>
                <span class="bounce-animation" style="animation-delay: 0.2s;">тЬПя╕П</span>
                <span class="wiggle-animation" style="animation-delay: 0.3s;">ЁЯУЦ</span>
              </div>
            </div>
            
            <h1 id="schoolNameDisplay" class="text-2xl font-bold text-center bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
              р╕гр╕░р╕Ър╕Ър╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ
            </h1>
            <p class="text-gray-500 text-center mb-6 text-sm">ЁЯПл р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ - р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯОл р╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
                </label>
                <input type="text" id="studentIdInput" placeholder="р╣Ар╕Кр╣Ир╕Щ 12345" 
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯкк р╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╕Ыр╕гр╕░р╕Кр╕▓р╕Кр╕Щ (4 р╕Хр╕▒р╕зр╕Чр╣Йр╕▓р╕в)
                </label>
                <input type="password" id="nationalIdInput" placeholder="р╣Ар╕Кр╣Ир╕Щ 1234" maxlength="4"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              
              <button type="button" onclick="studentLogin()" 
                class="w-full py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-blue-600 transform hover:scale-[1.02] transition-all shadow-lg">
                ЁЯЪА р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
              </button>
              
              <div class="relative my-4">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                  <span class="px-4 bg-white text-gray-400">р╕лр╕гр╕╖р╕н</span>
                </div>
              </div>
              
              <button type="button" onclick="showTeacherLogin()" 
                class="w-full py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl font-semibold hover:from-green-600 hover:to-teal-600 transform hover:scale-[1.02] transition-all shadow-lg">
                ЁЯСитАНЁЯПл р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕гр╕╣
              </button>
            </div>
            
            <div id="loginError" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm hidden">
              тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Teacher Login Page -->
    <div id="teacherLoginPage" class="min-h-full w-full flex items-center justify-center p-4 relative z-10 hidden">
      <div class="w-full max-w-md">
        <div class="gradient-border cute-shadow">
          <div class="p-8">
            <div class="text-center mb-6">
              <div class="text-8xl mb-2 float-animation">ЁЯСитАНЁЯПл</div>
              <div class="flex justify-center gap-2 text-2xl">
                <span class="wiggle-animation">ЁЯУЛ</span>
                <span class="bounce-animation">тЬЕ</span>
                <span class="wiggle-animation">ЁЯУК</span>
              </div>
            </div>
            
            <h1 class="text-2xl font-bold text-center bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent mb-2">
              р╕гр╕░р╕Ър╕Ър╕лр╕ер╕▒р╕Зр╕Ър╣Йр╕▓р╕Щ
            </h1>
            <p class="text-gray-500 text-center mb-6 text-sm">ЁЯПл р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕гр╕╣р╣Бр╕ер╕░р╕Ър╕╕р╕Др╕ер╕▓р╕Бр╕г</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯСд р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
                </label>
                <input type="text" id="teacherUsername" placeholder="username"
                  class="w-full px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯФС р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
                </label>
                <input type="password" id="teacherPassword" placeholder="password"
                  class="w-full px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all">
              </div>
              
              <button type="button" onclick="teacherLogin()" 
                class="w-full py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl font-semibold hover:from-green-600 hover:to-teal-600 transform hover:scale-[1.02] transition-all shadow-lg">
                ЁЯФУ р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
              </button>
              
              <button type="button" onclick="showStudentLogin()" 
                class="w-full py-2 text-gray-500 hover:text-gray-700 transition-all">
                тЖР р╕Бр╕ер╕▒р╕Ър╕лр╕Щр╣Йр╕▓р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
              </button>
            </div>
            
            <div id="teacherLoginError" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm hidden">
              тЭМ р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕лр╕гр╕╖р╕нр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
            </div>
            
            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-xl text-blue-600 text-sm">
              ЁЯТб р╕Чр╕Фр╕кр╕нр╕Ъ: admin / 1234
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Student Dashboard -->
    <div id="studentDashboard" class="min-h-full w-full p-4 relative z-10 hidden">
      <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-2xl p-4 mb-4 cute-shadow">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="text-4xl float-animation">ЁЯСитАНЁЯОУ</div>
              <div>
                <p class="font-semibold text-gray-800" id="welcomeStudent">р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ</p>
                <p class="text-sm text-gray-500" id="studentIdDisplay">р╕гр╕лр╕▒р╕к: -</p>
              </div>
            </div>
            <button type="button" onclick="logout()" class="px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-all text-sm font-medium">
              ЁЯЪк р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ
            </button>
          </div>
        </div>
        
        <!-- Tabs -->
        <div class="glass-card rounded-2xl p-2 mb-4 cute-shadow">
          <div class="flex gap-2">
            <button type="button" onclick="showStudentTab('request')" id="tabRequest" 
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white">
              ЁЯУЭ р╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ
            </button>
            <button type="button" onclick="showStudentTab('history')" id="tabHistory"
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200">
              ЁЯУЛ р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕н
            </button>
          </div>
        </div>
        
        <!-- Request Form -->
        <div id="requestForm" class="glass-card rounded-2xl p-6 cute-shadow">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl wiggle-animation">ЁЯУЭ</span>
            <h2 class="text-xl font-bold text-gray-800">р╣Бр╕Ър╕Ър╕Яр╕нр╕гр╣Мр╕бр╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ</h2>
          </div>
          
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯСд р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е</label>
                <input type="text" id="formName" placeholder="р╕Кр╕╖р╣Ир╕н р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯПл р╕лр╣Йр╕нр╕Зр╣Ар╕гр╕╡р╕вр╕Щ</label>
                <input type="text" id="formClass" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕б.3/1"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕ер╕▓</label>
                <input type="date" id="formDate"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯХР р╣Ар╕зр╕ер╕▓р╕нр╕нр╕Б</label>
                <input type="time" id="formTimeOut"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯХР р╣Ар╕зр╕ер╕▓р╕Бр╕ер╕▒р╕Ъ (р╕Цр╣Йр╕▓р╕Бр╕ер╕▒р╕Ър╕бр╕▓)</label>
              <input type="time" id="formTimeReturn" placeholder="р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ"
                class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯУЛ р╣Ар╕лр╕Хр╕╕р╕Ьр╕ер╕Бр╕▓р╕гр╕ер╕▓</label>
              <select id="formReason" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
                <option value="">-- р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕лр╕Хр╕╕р╕Ьр╕е --</option>
                <option value="р╕Ыр╣Ир╕зр╕в/р╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣М">ЁЯПе р╕Ыр╣Ир╕зр╕в/р╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣М</option>
                <option value="р╕Шр╕╕р╕гр╕░р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з">ЁЯСитАНЁЯСйтАНЁЯСз р╕Шр╕╕р╕гр╕░р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з</option>
                <option value="р╕Фр╕╣р╣Бр╕ер╕Ьр╕╣р╣Йр╕Ыр╣Ир╕зр╕в">ЁЯТК р╕Фр╕╣р╣Бр╕ер╕Ьр╕╣р╣Йр╕Ыр╣Ир╕зр╕в</option>
                <option value="р╕Шр╕╕р╕гр╕░р╕Фр╣Ир╕зр╕Щ">тЪб р╕Шр╕╕р╕гр╕░р╕Фр╣Ир╕зр╕Щ</option>
                <option value="р╕нр╕╖р╣Ир╕Щр╣Ж">ЁЯУЭ р╕нр╕╖р╣Ир╕Щр╣Ж (р╕гр╕░р╕Ър╕╕р╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕З)</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯУЭ р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вр╕Фр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б</label>
              <textarea id="formReasonDetail" rows="2" placeholder="р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б (р╕Цр╣Йр╕▓р╕бр╕╡)"
                class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all resize-none"></textarea>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ЁЯУ╖ р╣Бр╕Щр╕Ър╕гр╕╣р╕Ыр╕Ьр╕╣р╣Йр╕Ыр╕Бр╕Др╕гр╕нр╕Зр╕Чр╕╡р╣Ир╕бр╕▓р╕гр╕▒р╕Ъ</label>
              <div class="border-2 border-dashed border-purple-200 rounded-xl p-4 text-center hover:border-purple-400 transition-all">
                <input type="file" id="formImage" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                <div id="imagePreview" class="hidden mb-3">
                  <img id="previewImg" class="max-h-40 mx-auto rounded-xl shadow-lg">
                </div>
                <button type="button" onclick="document.getElementById('formImage').click()" 
                  class="px-6 py-3 bg-purple-100 text-purple-600 rounded-xl hover:bg-purple-200 transition-all font-medium">
                  ЁЯУ╕ р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю р╕лр╕гр╕╖р╕н р╕Цр╣Ир╕▓р╕вр╕гр╕╣р╕Ы
                </button>
                <p class="text-xs text-gray-400 mt-2">р╕гр╕нр╕Зр╕гр╕▒р╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Ю (р╕Ир╕░р╕Ър╕╡р╕Ър╕нр╕▒р╕Фр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤)</p>
              </div>
            </div>
            
            <button type="button" onclick="submitRequest()" id="submitBtn"
              class="w-full py-4 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-blue-600 transform hover:scale-[1.02] transition-all shadow-lg text-lg">
              тЬи р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ
            </button>
          </div>
          
          <div id="submitMessage" class="mt-4 hidden"></div>
        </div>
        
        <!-- History -->
        <div id="historySection" class="glass-card rounded-2xl p-6 cute-shadow hidden">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl bounce-animation">ЁЯУЛ</span>
            <h2 class="text-xl font-bold text-gray-800">р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕нр╕ер╕▓</h2>
          </div>
          <div id="studentHistoryList" class="space-y-3">
            <div class="text-center py-8 text-gray-400">
              <div class="text-<!DOCTYPE html>
<html lang="th" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>р╕гр╕░р╕Ър╕Ър╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Prompt', sans-serif;
    }
    
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    
    @keyframes wiggle {
      0%, 100% { transform: rotate(-3deg); }
      50% { transform: rotate(3deg); }
    }
    
    @keyframes bounce-slow {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }
    
    @keyframes pulse-ring {
      0% { transform: scale(0.8); opacity: 1; }
      100% { transform: scale(1.5); opacity: 0; }
    }
    
    @keyframes leaf-sway {
      0%, 100% { transform: rotate(-5deg) translateX(0); }
      50% { transform: rotate(5deg) translateX(5px); }
    }
    
    @keyframes cloud-move {
      0% { transform: translateX(-10px); }
      100% { transform: translateX(10px); }
    }
    
    .float-animation { animation: float 3s ease-in-out infinite; }
    .wiggle-animation { animation: wiggle 2s ease-in-out infinite; }
    .bounce-animation { animation: bounce-slow 2s ease-in-out infinite; }
    .leaf-animation { animation: leaf-sway 4s ease-in-out infinite; }
    .cloud-animation { animation: cloud-move 6s ease-in-out infinite alternate; }
    
    .notification-badge {
      position: relative;
    }
    
    .notification-badge::after {
      content: '';
      position: absolute;
      top: -2px;
      right: -2px;
      width: 12px;
      height: 12px;
      background: #ef4444;
      border-radius: 50%;
      animation: pulse-ring 1.5s ease-out infinite;
    }
    
    .glass-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    
    .gradient-border {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 3px;
      border-radius: 1rem;
    }
    
    .gradient-border > div {
      background: white;
      border-radius: calc(1rem - 3px);
    }
    
    .school-pattern {
      background-image: 
        radial-gradient(circle at 20% 80%, rgba(120, 200, 120, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, rgba(100, 180, 255, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 40% 40%, rgba(255, 200, 100, 0.05) 0%, transparent 30%);
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      ring: 2px;
      ring-color: #667eea;
    }
    
    .cute-shadow {
      box-shadow: 0 10px 40px rgba(102, 126, 234, 0.15), 0 4px 12px rgba(0, 0, 0, 0.05);
    }
    
    .status-pending { background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); }
    .status-approved { background: linear-gradient(135deg, #34d399 0%, #10b981 100%); }
    .status-rejected { background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); }
  </style>
</head>
<body class="h-full bg-gradient-to-br from-green-50 via-blue-50 to-purple-50 school-pattern overflow-auto">
  <div id="app" class="min-h-full w-full">
    
    <!-- Decorative Elements -->
    <div class="fixed top-10 left-10 text-6xl float-animation opacity-60 pointer-events-none z-0">ЁЯМ│</div>
    <div class="fixed top-20 right-20 text-5xl wiggle-animation opacity-60 pointer-events-none z-0">ЁЯМ╕</div>
    <div class="fixed bottom-20 left-20 text-4xl bounce-animation opacity-60 pointer-events-none z-0">ЁЯУЪ</div>
    <div class="fixed bottom-10 right-10 text-5xl leaf-animation opacity-60 pointer-events-none z-0">ЁЯНГ</div>
    <div class="fixed top-40 left-1/4 text-3xl cloud-animation opacity-40 pointer-events-none z-0">тШБя╕П</div>
    <div class="fixed top-60 right-1/4 text-4xl cloud-animation opacity-40 pointer-events-none z-0" style="animation-delay: 2s;">тШБя╕П</div>
    
    <!-- Login Page - Student -->
    <div id="loginPage" class="min-h-full w-full flex items-center justify-center p-4 relative z-10">
      <div class="w-full max-w-md">
        <div class="gradient-border cute-shadow">
          <div class="p-8">
            <!-- Cute Student Character -->
            <div class="text-center mb-6">
              <div class="text-8xl mb-2 float-animation">ЁЯСитАНЁЯОУ</div>
              <div class="flex justify-center gap-2 text-2xl">
                <span class="wiggle-animation" style="animation-delay: 0.1s;">ЁЯОТ</span>
                <span class="bounce-animation" style="animation-delay: 0.2s;">тЬПя╕П</span>
                <span class="wiggle-animation" style="animation-delay: 0.3s;">ЁЯУЦ</span>
              </div>
            </div>
            
            <h1 id="schoolNameDisplay" class="text-2xl font-bold text-center bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
              р╕гр╕░р╕Ър╕Ър╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ
            </h1>
            <p class="text-gray-500 text-center mb-6 text-sm">ЁЯПл р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ - р╕Бр╕гр╕╕р╕Ур╕▓р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯОл р╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
                </label>
                <input type="text" id="studentIdInput" placeholder="р╣Ар╕Кр╣Ир╕Щ 12345" 
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯкк р╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╕Ыр╕гр╕░я┐╜я┐╜р╕▓р╕Кр╕Щ (4 р╕Хр╕▒р╕зр╕Чр╣Йр╕▓р╕в)
                </label>
                <input type="password" id="nationalIdInput" placeholder="р╣Ар╕Кр╣Ир╕Щ 1234" maxlength="4"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              
              <button onclick="studentLogin()" 
                class="w-full py-3 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-blue-600 transform hover:scale-[1.02] transition-all shadow-lg">
                ЁЯЪА р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
              </button>
              
              <div class="relative my-4">
                <div class="absolute inset-0 flex items-center">
                  <div class="w-full border-t border-gray-200"></div>
                </div>
                <div class="relative flex justify-center text-sm">
                  <span class="px-4 bg-white text-gray-400">р╕лр╕гр╕╖р╕н</span>
                </div>
              </div>
              
              <button onclick="showTeacherLogin()" 
                class="w-full py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl font-semibold hover:from-green-600 hover:to-teal-600 transform hover:scale-[1.02] transition-all shadow-lg">
                ЁЯСитАНЁЯПл р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕гр╕╣
              </button>
            </div>
            
            <div id="loginError" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm hidden">
              тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Teacher Login Page -->
    <div id="teacherLoginPage" class="min-h-full w-full flex items-center justify-center p-4 relative z-10 hidden">
      <div class="w-full max-w-md">
        <div class="gradient-border cute-shadow">
          <div class="p-8">
            <div class="text-center mb-6">
              <div class="text-8xl mb-2 float-animation">ЁЯСитАНЁЯПл</div>
              <div class="flex justify-center gap-2 text-2xl">
                <span class="wiggle-animation">ЁЯУЛ</span>
                <span class="bounce-animation">тЬЕ</span>
                <span class="wiggle-animation">ЁЯУК</span>
              </div>
            </div>
            
            <h1 class="text-2xl font-bold text-center bg-gradient-to-r from-green-600 to-teal-600 bg-clip-text text-transparent mb-2">
              р╕гр╕░р╕Ър╕Ър╕лр╕ер╕▒р╕Зр╕Ър╣Йр╕▓р╕Щ
            </h1>
            <p class="text-gray-500 text-center mb-6 text-sm">ЁЯПл р╕кр╕│р╕лр╕гр╕▒р╕Ър╕Др╕гр╕╣р╣Бр╕ер╕░р╕Ър╕╕р╕Др╕ер╕▓р╕Бр╕г</p>
            
            <div class="space-y-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯСд р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й
                </label>
                <input type="text" id="teacherUsername" placeholder="username"
                  class="w-full px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all">
              </div>
              
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">
                  ЁЯФС р╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щ
                </label>
                <input type="password" id="teacherPassword" placeholder="password"
                  class="w-full px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all">
              </div>
              
              <button onclick="teacherLogin()" 
                class="w-full py-3 bg-gradient-to-r from-green-500 to-teal-500 text-white rounded-xl font-semibold hover:from-green-600 hover:to-teal-600 transform hover:scale-[1.02] transition-all shadow-lg">
                ЁЯФУ р╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ
              </button>
              
              <button onclick="showStudentLogin()" 
                class="w-full py-2 text-gray-500 hover:text-gray-700 transition-all">
                тЖР р╕Бр╕ер╕▒р╕Ър╕лр╕Щр╣Йр╕▓р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ
              </button>
            </div>
            
            <div id="teacherLoginError" class="mt-4 p-3 bg-red-50 border border-red-200 rounded-xl text-red-600 text-sm hidden">
              тЭМ р╕Кр╕╖р╣Ир╕нр╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╕лр╕гр╕╖р╕нр╕гр╕лр╕▒р╕кр╕Ьр╣Ир╕▓р╕Щр╣Др╕бр╣Ир╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
            </div>
            
            <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded-xl text-blue-600 text-sm">
              ЁЯТб р╕Чр╕Фр╕кр╕нр╕Ъ: admin / 1234
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Student Dashboard -->
    <div id="studentDashboard" class="min-h-full w-full p-4 relative z-10 hidden">
      <div class="max-w-2xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-2xl p-4 mb-4 cute-shadow">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="text-4xl float-animation">ЁЯСитАНЁЯОУ</div>
              <div>
                <p class="font-semibold text-gray-800" id="welcomeStudent">р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ</p>
                <p class="text-sm text-gray-500" id="studentIdDisplay">р╕гр╕лр╕▒р╕к: -</p>
              </div>
            </div>
            <button onclick="logout()" class="px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-all text-sm font-medium">
              ЁЯЪк р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ
            </button>
          </div>
        </div>
        
        <!-- Tabs -->
        <div class="glass-card rounded-2xl p-2 mb-4 cute-shadow">
          <div class="flex gap-2">
            <button onclick="showStudentTab('request')" id="tabRequest" 
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white">
              ЁЯУЭ р╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ
            </button>
            <button onclick="showStudentTab('history')" id="tabHistory"
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200">
              ЁЯУЛ р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕н
            </button>
          </div>
        </div>
        
        <!-- Request Form -->
        <div id="requestForm" class="glass-card rounded-2xl p-6 cute-shadow">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl wiggle-animation">ЁЯУЭ</span>
            <h2 class="text-xl font-bold text-gray-800">р╣Бр╕Ър╕Ър╕Яр╕нр╕гр╣Мр╕бр╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ</h2>
          </div>
          
          <div class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯСд р╕Кр╕╖р╣Ир╕н-р╕кр╕Бр╕╕р╕е</label>
                <input type="text" id="formName" placeholder="р╕Кр╕╖р╣Ир╕н р╕Щр╕▓р╕бр╕кр╕Бр╕╕р╕е"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯПл р╕лр╣Йр╕нр╕Зр╣Ар╕гр╕╡р╕вр╕Щ</label>
                <input type="text" id="formClass" placeholder="р╣Ар╕Кр╣Ир╕Щ р╕б.3/1"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
            </div>
            
            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯУЕ р╕зр╕▒р╕Щр╕Чр╕╡р╣Ир╕ер╕▓</label>
                <input type="date" id="formDate"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯХР р╣Ар╕зр╕ер╕▓р╕нр╕нр╕Б</label>
                <input type="time" id="formTimeOut"
                  class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
              </div>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯХР р╣Ар╕зр╕ер╕▓р╕Бр╕ер╕▒р╕Ъ (р╕Цр╣Йр╕▓р╕Бр╕ер╕▒р╕Ър╕бр╕▓)</label>
              <input type="time" id="formTimeReturn" placeholder="р╣Др╕бр╣Ир╕Ър╕▒р╕Зр╕Др╕▒р╕Ъ"
                class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯУЛ р╣Ар╕лр╕Хр╕╕р╕Ьр╕ер╕Бр╕▓р╕гя┐╜я┐╜р╕▓</label>
              <select id="formReason" class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all">
                <option value="">-- р╣Ар╕ер╕╖р╕нр╕Бр╣Ар╕лр╕Хр╕╕р╕Ьр╕е --</option>
                <option value="р╕Ыр╣Ир╕зр╕в/р╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣М">ЁЯПе р╕Ыр╣Ир╕зр╕в/р╕Юр╕Ър╣Бр╕Юр╕Чр╕вр╣М</option>
                <option value="р╕Шр╕╕р╕гр╕░р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з">ЁЯСитАНЁЯСйтАНЁЯСз р╕Шр╕╕р╕гр╕░р╕Др╕гр╕нр╕Ър╕Др╕гр╕▒р╕з</option>
                <option value="р╕Фр╕╣р╣Бр╕ер╕Ьр╕╣р╣Йр╕Ыр╣Ир╕зр╕в">ЁЯТК р╕Фр╕╣р╣Бр╕ер╕Ьр╕╣р╣Йр╕Ыр╣Ир╕зр╕в</option>
                <option value="р╕Шр╕╕р╕гр╕░р╕Фр╣Ир╕зр╕Щ">тЪб р╕Шр╕╕р╕гр╕░р╕Фр╣Ир╕зр╕Щ</option>
                <option value="р╕нр╕╖р╣Ир╕Щр╣Ж">ЁЯУЭ р╕нр╕╖р╣Ир╕Щр╣Ж (р╕гр╕░р╕Ър╕╕р╕Фр╣Йр╕▓р╕Щр╕ер╣Ир╕▓р╕З)</option>
              </select>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-1">ЁЯУЭ р╕гр╕▓р╕вр╕ер╕░р╣Ар╕нр╕╡р╕вя┐╜я┐╜р╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б</label>
              <textarea id="formReasonDetail" rows="2" placeholder="р╕нр╕Шр╕┤р╕Ър╕▓р╕вр╣Ар╕Юр╕┤р╣Ир╕бр╣Ар╕Хр╕┤р╕б (р╕Цр╣Йр╕▓р╕бр╕╡)"
                class="w-full px-4 py-3 border-2 border-purple-100 rounded-xl focus:border-purple-400 transition-all resize-none"></textarea>
            </div>
            
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">ЁЯУ╖ р╣Бр╕Щр╕Ър╕гр╕╣р╕Ыр╕Ьр╕╣р╣Йр╕Ыр╕Бр╕Др╕гр╕нр╕Зр╕Чр╕╡р╣Ир╕бр╕▓р╕гр╕▒р╕Ъ</label>
              <div class="border-2 border-dashed border-purple-200 rounded-xl p-4 text-center hover:border-purple-400 transition-all">
                <input type="file" id="formImage" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                <div id="imagePreview" class="hidden mb-3">
                  <img id="previewImg" class="max-h-40 mx-auto rounded-xl shadow-lg">
                </div>
                <button type="button" onclick="document.getElementById('formImage').click()" 
                  class="px-6 py-3 bg-purple-100 text-purple-600 rounded-xl hover:bg-purple-200 transition-all font-medium">
                  ЁЯУ╕ р╣Ар╕ер╕╖р╕нр╕Бр╕гр╕╣р╕Ыр╕ар╕▓р╕Ю р╕лр╕гр╕╖р╕н р╕Цр╣Ир╕▓р╕вр╕гр╕╣р╕Ы
                </button>
                <p class="text-xs text-gray-400 mt-2">р╕гр╕нр╕Зр╕гр╕▒р╕Ър╣Др╕Яр╕ер╣Мр╕ар╕▓р╕Ю (р╕Ир╕░р╕Ър╕╡р╕Ър╕нр╕▒р╕Фр╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤)</p>
              </div>
            </div>
            
            <button onclick="submitRequest()" id="submitBtn"
              class="w-full py-4 bg-gradient-to-r from-purple-500 to-blue-500 text-white rounded-xl font-semibold hover:from-purple-600 hover:to-blue-600 transform hover:scale-[1.02] transition-all shadow-lg text-lg">
              тЬи р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ
            </button>
          </div>
          
          <div id="submitMessage" class="mt-4 hidden"></div>
        </div>
        
        <!-- History -->
        <div id="historySection" class="glass-card rounded-2xl p-6 cute-shadow hidden">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl bounce-animation">ЁЯУЛ</span>
            <h2 class="text-xl font-bold text-gray-800">я┐╜я┐╜я┐╜р╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕нр╕ер╕▓</h2>
          </div>
          <div id="studentHistoryList" class="space-y-3">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯУн</div>
              <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕нр╕ер╕▓</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Teacher Dashboard -->
    <div id="teacherDashboard" class="min-h-full w-full p-4 relative z-10 hidden">
      <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-2xl p-4 mb-4 cute-shadow">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-3">
              <div class="text-4xl wiggle-animation">ЁЯСитАНЁЯПл</div>
              <div>
                <p class="font-semibold text-gray-800">р╕гр╕░р╕Ър╕Ър╕лр╕ер╕▒р╕Зр╕Ър╣Йр╕▓р╕Щ</p>
                <p class="text-sm text-gray-500">р╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <div id="notificationBell" class="relative cursor-pointer p-2 hover:bg-gray-100 rounded-full transition-all">
                <span class="text-2xl">ЁЯФФ</span>
                <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold hidden">0</span>
              </div>
              <button onclick="logout()" class="px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-all text-sm font-medium">
                ЁЯЪк р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ
              </button>
            </div>
          </div>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center text-2xl">тП│</div>
              <div>
                <p class="text-2xl font-bold text-yellow-600" id="statPending">0</p>
                <p class="text-xs text-gray-500">р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</p>
              </div>
            </div>
          </div>
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-2xl">тЬЕ</div>
              <div>
                <p class="text-2xl font-bold text-green-600" id="statApproved">0</p>
                <p class="text-xs text-gray-500">я┐╜я┐╜р╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Бр╕ер╣Йр╕з</p>
              </div>
            </div>
          </div>
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center text-2xl">тЭМ</div>
              <div>
                <p class="text-2xl font-bold text-red-600" id="statRejected">0</p>
                <p class="text-xs text-gray-500">р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</p>
              </div>
            </div>
          </div>
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-2xl">ЁЯУК</div>
              <div>
                <p class="text-2xl font-bold text-blue-600" id="statTotal">0</p>
                <p class="text-xs text-gray-500">р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Teacher Tabs -->
        <div class="glass-card rounded-2xl p-2 mb-4 cute-shadow">
          <div class="flex gap-2 flex-wrap">
            <button onclick="showTeacherTab('pending')" id="teacherTabPending" 
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-green-500 to-teal-500 text-white min-w-fit">
              тП│ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕│р╕Вр╕н
            </button>
            <button onclick="showTeacherTab('all')" id="teacherTabAll"
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200 min-w-fit">
              ЁЯУЛ р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
            </button>
            <button onclick="showTeacherTab('search')" id="teacherTabSearch"
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200 min-w-fit">
              ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓
            </button>
          </div>
        </div>
        
        <!-- Pending Requests -->
        <div id="pendingSection" class="glass-card rounded-2xl p-6 cute-shadow">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl wiggle-animation">тП│</span>
            <h2 class="text-xl font-bold text-gray-800">р╕Др╕│р╕Вр╕нр╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</h2>
          </div>
          <div id="pendingList" class="space-y-4">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯУн</div>
              <p>р╣Др╕бр╣Ир╕бр╕╡р╕Др╕│р╕Вр╕нр╕Чр╕╡р╣Ир╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</p>
            </div>
          </div>
        </div>
        
        <!-- All Records -->
        <div id="allSection" class="glass-card rounded-2xl p-6 cute-shadow hidden">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl bounce-animation">ЁЯУЛ</span>
            <h2 class="text-xl font-bold text-gray-800">р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</h2>
          </div>
          <div id="allList" class="space-y-4">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯУн</div>
              <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е</p>
            </div>
          </div>
        </div>
        
        <!-- Search Section -->
        <div id="searchSection" class="glass-card rounded-2xl p-6 cute-shadow hidden">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl bounce-animation">ЁЯФН</span>
            <h2 class="text-xl font-bold text-gray-800">р╕Др╣Йр╕Щр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕е</h2>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <input type="text" id="searchName" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Кр╕╖р╣Ир╕н/р╕гр╕лр╕▒р╕кр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ"
              class="px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all"
              oninput="performSearch()">
            <input type="date" id="searchDate"
              class="px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all"
              onchange="performSearch()">
            <select id="searchStatus" class="px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all"
              onchange="performSearch()">
              <option value="">-- р╕Чр╕╕р╕Бр╕кр╕Цр╕▓р╕Щр╕░ --</option>
              <option value="pending">тП│ р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</option>
              <option value="approved">тЬЕ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Бр╕ер╣Йр╕з</option>
              <option value="rejected">тЭМ р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</option>
            </select>
          </div>
          <div id="searchResults" class="space-y-4">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯФН</div>
              <p>р╕Юр╕┤р╕бр╕Юр╣Мр╣Ар╕Юр╕╖р╣Ир╕ня┐╜я┐╜р╣Йр╕Щр╕лр╕▓</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Reject Modal -->
    <div id="rejectModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
      <div class="bg-white rounded-2xl p-6 w-full max-w-md cute-shadow">
        <div class="text-center mb-4">
          <div class="text-5xl mb-2">тЭМ</div>
          <h3 class="text-xl font-bold text-gray-800">р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕н</h3>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</label>
          <textarea id="rejectNote" rows="3" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕░р╕Ър╕╕р╣Ар╕лр╕Хр╕╕р╕Ьр╕е..."
            class="w-full px-4 py-3 border-2 border-red-100 rounded-xl focus:border-red-400 transition-all resize-none"></textarea>
        </div>
        <div class="flex gap-3">
          <button onclick="closeRejectModal()" 
            class="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all">
            р╕вр╕Бр╣Ар╕ер╕┤р╕Б
          </button>
          <button onclick="confirmReject()" 
            class="flex-1 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-all">
            тЭМ р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
          </button>
        </div>
      </div>
    </div>
    
    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden p-4" onclick="closeImageModal()">
      <div class="max-w-2xl max-h-[80%] overflow-hidden">
        <img id="modalImage" class="max-w-full max-h-full rounded-xl shadow-2xl">
      </div>
    </div>
    
    <!-- Notification Toast -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg z-50 hidden transform translate-x-full transition-transform">
      <div class="flex items-center gap-3">
        <span class="text-2xl">ЁЯФФ</span>
        <div>
          <p class="font-semibold" id="toastTitle">р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ</p>
          <p class="text-sm opacity-90" id="toastMessage">р╕бр╕╡р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣И</p>
        </div>
      </div>
    </div>
    
  </div>

  <script>
    // Global State
    let currentUser = null;
    let userType = null;
    let allRecords = [];
    let pendingRejectId = null;
    let lastPendingCount = 0;
    
    const defaultConfig = {
      school_name: 'р╕гр╕░р╕Ър╕Ър╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ'
    };
    
    // LocalStorage Keys
    const STORAGE_KEY = 'leaveRecords';
    
    // Initialize
    async function initApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const schoolName = config.school_name || defaultConfig.school_name;
            const el = document.getElementById('schoolNameDisplay');
            if (el) el.textContent = schoolName;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['school_name', config.school_name || defaultConfig.school_name]
          ])
        });
      }
      
      // Load records from localStorage
      loadRecords();
      
      // Set default date/time
      const today = new Date();
      const dateInput = document.getElementById('formDate');
      if (dateInput) {
        dateInput.value = today.toISOString().split('T')[0];
      }
      
      const timeInput = document.getElementById('formTimeOut');
      if (timeInput) {
        timeInput.value = today.toTimeString().slice(0, 5);
      }
    }
    
    // Load records from localStorage
    function loadRecords() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        allRecords = stored ? JSON.parse(stored) : [];
      } catch (err) {
        console.error('Failed to load records:', err);
        allRecords = [];
      }
    }
    
    // Save records to localStorage
    function saveRecords() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allRecords));
      } catch (err) {
        console.error('Failed to save records:', err);
      }
    }
    
    // Check for new notifications (for teachers)
    function checkNotifications() {
      if (userType !== 'teacher') return;
      
      const pendingCount = allRecords.filter(r => r.status === 'pending').length;
      
      if (pendingCount > lastPendingCount && lastPendingCount > 0) {
        showToast('р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣И!', `р╕бр╕╡ ${pendingCount - lastPendingCount} р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣Ир╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г`);
      }
      
      lastPendingCount = pendingCount;
      
      // Update notification badge
      const countEl = document.getElementById('notificationCount');
      if (countEl) {
        if (pendingCount > 0) {
          countEl.textContent = pendingCount;
          countEl.classList.remove('hidden');
        } else {
          countEl.classList.add('hidden');
        }
      }
    }
    
    // Show toast notification
    function showToast(title, message) {
      const toast = document.getElementById('toast');
      const toastTitle = document.getElementById('toastTitle');
      const toastMessage = document.getElementById('toastMessage');
      
      if (toast && toastTitle && toastMessage) {
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        toast.classList.remove('hidden', 'translate-x-full');
        
        setTimeout(() => {
          toast.classList.add('translate-x-full');
          setTimeout(() => toast.classList.add('hidden'), 300);
        }, 4000);
      }
    }
    
    // Update all UI elements
    function updateUI() {
      updateStats();
      
      if (userType === 'student' && currentUser) {
        updateStudentHistory();
      } else if (userType === 'teacher') {
        updatePendingList();
        updateAllList();
        performSearch();
      }
      
      checkNotifications();
    }
    
    // Update stats
    function updateStats() {
      const pending = allRecords.filter(r => r.status === 'pending').length;
      const approved = allRecords.filter(r => r.status === 'approved').length;
      const rejected = allRecords.filter(r => r.status === 'rejected').length;
      
      const statPending = document.getElementById('statPending');
      const statApproved = document.getElementById('statApproved');
      const statRejected = document.getElementById('statRejected');
      const statTotal = document.getElementById('statTotal');
      
      if (statPending) statPending.textContent = pending;
      if (statApproved) statApproved.textContent = approved;
      if (statRejected) statRejected.textContent = rejected;
      if (statTotal) statTotal.textContent = allRecords.length;
    }
    
    // Student login
    function studentLogin() {
      const studentId = document.getElementById('studentIdInput')?.value?.trim();
      const nationalId = document.getElementById('nationalIdInput')?.value?.trim();
      const errorEl = document.getElementById('loginError');
      
      if (!studentId || !nationalId || nationalId.length !== 4) {
        if (errorEl) {
          errorEl.textContent = 'тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╣Бр╕ер╕░р╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Кр╕▓р╕Кр╕Щ 4 р╕Хр╕▒р╕зр╕Чр╣Йр╕▓р╕в';
          errorEl.classList.remove('hidden');
        }
        return;
      }
      
      currentUser = { studentId, nationalId };
      userType = 'student';
      
      const loginPageEl = document.getElementById('loginPage');
      const dashboardEl = document.getElementById('studentDashboard');
      
      if (loginPageEl) loginPageEl.classList.add('hidden');
      if (dashboardEl) dashboardEl.classList.remove('hidden');
      
      const welcomeEl = document.getElementById('welcomeStudent');
      const idEl = document.getElementById('studentIdDisplay');
      
      if (welcomeEl) welcomeEl.textContent = `р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ`;
      if (idEl) idEl.textContent = `р╕гр╕лр╕▒р╕к: ${studentId}`;
      
      updateUI();
    }
    
    // Teacher login
    function teacherLogin() {
      const username = document.getElementById('teacherUsername')?.value?.trim();
      const password = document.getElementById('teacherPassword')?.value?.trim();
      const errorEl = document.getElementById('teacherLoginError');
      
      if (username === 'admin' && password === '1234') {
        currentUser = { username };
        userType = 'teacher';
        lastPendingCount = allRecords.filter(r => r.status === 'pending').length;
        
        const teacherLoginEl = document.getElementById('teacherLoginPage');
        const teacherDashEl = document.getElementById('teacherDashboard');
        
        if (teacherLoginEl) teacherLoginEl.classList.add('hidden');
        if (teacherDashEl) teacherDashEl.classList.remove('hidden');
        
        updateUI();
      } else {
        if (errorEl) {
          errorEl.classList.remove('hidden');
        }
      }
    }
    
    // Show teacher login
    function showTeacherLogin() {
      const loginPageEl = document.getElementById('loginPage');
      const teacherLoginEl = document.getElementById('teacherLoginPage');
      
      if (loginPageEl) loginPageEl.classList.add('hidden');
      if (teacherLoginEl) teacherLoginEl.classList.remove('hidden');
    }
    
    // Show student login
    function showStudentLogin() {
      const teacherLoginEl = document.getElementById('teacherLoginPage');
      const loginPageEl = document.getElementById('loginPage');
      
      if (teacherLoginEl) teacherLoginEl.classList.add('hidden');
      if (loginPageEl) loginPageEl.classList.remove('hidden');
    }
    
    // Logout
    function logout() {
      currentUser = null;
      userType = null;
      
      const studentDashEl = document.getElementById('studentDashboard');
      const teacherDashEl = document.getElementById('teacherDashboard');
      const loginPageEl = document.getElementById('loginPage');
      
      if (studentDashEl) studentDashEl.classList.add('hidden');
      if (teacherDashEl) teacherDashEl.classList.add('hidden');
      if (loginPageEl) loginPageEl.classList.remove('hidden');
      
      // Clear forms
      document.getElementById('studentIdInput').value = '';
      document.getElementById('nationalIdInput').value = '';
      document.getElementById('teacherUsername').value = '';
      document.getElementById('teacherPassword').value = '';
      document.getElementById('loginError').classList.add('hidden');
      document.getElementById('teacherLoginError').classList.add('hidden');
    }
    
    // Student tabs
    function showStudentTab(tab) {
      const tabRequest = document.getElementById('tabRequest');
      const tabHistory = document.getElementById('tabHistory');
      const requestForm = document.getElementById('requestForm');
      const historySection = document.getElementById('historySection');
      
      if (tab === 'request') {
        tabRequest.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white';
        tabHistory.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200';
        requestForm.classList.remove('hidden');
        historySection.classList.add('hidden');
      } else {
        tabHistory.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white';
        tabRequest.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200';
        historySection.classList.remove('hidden');
        requestForm.classList.add('hidden');
        updateStudentHistory();
      }
    }
    
    // Teacher tabs
    function showTeacherTab(tab) {
      const tabs = ['pending', 'all', 'search'];
      tabs.forEach(t => {
        const tabEl = document.getElementById(`teacherTab${t.charAt(0).toUpperCase() + t.slice(1)}`);
        const sectionEl = document.getElementById(`${t}Section`);
        
        if (t === tab) {
          tabEl.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-green-500 to-teal-500 text-white min-w-fit';
          sectionEl.classList.remove('hidden');
        } else {
          tabEl.className = 'flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200 min-w-fit';
          sectionEl.classList.add('hidden');
        }
      });
    }
    
    // Image upload with compression
    let uploadedImage = '';
    
    async function handleImageUpload(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      try {
        const compressed = await compressImage(file, 800, 0.7);
        uploadedImage = compressed;
        
        const previewEl = document.getElementById('imagePreview');
        const imgEl = document.getElementById('previewImg');
        
        if (previewEl && imgEl) {
          imgEl.src = compressed;
          previewEl.classList.remove('hidden');
        }
      } catch (err) {
        console.error('Image compression error:', err);
      }
    }
    
    function compressImage(file, maxWidth, quality) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            resolve(canvas.toDataURL('image/jpeg', quality));
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    // Submit request
    async function submitRequest() {
      const name = document.getElementById('formName').value.trim();
      const classRoom = document.getElementById('formClass').value.trim();
      const date = document.getElementById('formDate').value;
      const timeOut = document.getElementById('formTimeOut').value;
      const timeReturn = document.getElementById('formTimeReturn').value;
      const reason = document.getElementById('formReason').value;
      const reasonDetail = document.getElementById('formReasonDetail').value.trim();
      const messageEl = document.getElementById('submitMessage');
      const submitBtn = document.getElementById('submitBtn');
      
      // Validation
      if (!name || !classRoom || !date || !timeOut || !reason) {
        messageEl.innerHTML = '<div class="p-4 bg-red-50 border border-red-200 rounded-xl text-red-600">тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╣Йр╕Др╕гр╕Ър╕Цр╣Йр╕зр╕Щ</div>';
        messageEl.classList.remove('hidden');
        return;
      }
      
      // Check record limit
      if (allRecords.length >= 999) {
        messageEl.innerHTML = '<div class="p-4 bg-red-50 border border-red-200 rounded-xl text-red-600">тЭМ р╕гя┐╜я┐╜р╕Ър╕Ър╣Ар╕Хр╣Зр╕бр╣Бр╕ер╣Йр╕з р╕Бр╕гр╕╕р╕Ур╕▓р╕Хр╕┤р╕Фр╕Хр╣Ир╕нр╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ</div>';
        messageEl.classList.remove('hidden');
        return;
      }
      
      // Show loading
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<span class="animate-pulse">тП│ р╕Бр╕│р╕ер╕▒р╕Зр╕кр╣Ир╕Зр╕Др╕│р╕Вр╕н...</span>';
      
      const fullReason = reasonDetail ? `${reason} - ${reasonDetail}` : reason;
      
      const record = {
        id: 'leave_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
        type: 'leave_request',
        student_id: currentUser.studentId,
        national_id: currentUser.nationalId,
        student_name: name,
        class_room: classRoom,
        leave_date: date,
        leave_time: timeOut,
        return_time: timeReturn || '',
        reason: fullReason,
        parent_image: uploadedImage || '',
        status: 'pending',
        reject_note: '',
        created_at: new Date().toISOString(),
        approved_at: '',
        approved_by: ''
      };
      
      try {
        allRecords.push(record);
        saveRecords();
        
        messageEl.innerHTML = '<div class="p-4 bg-green-50 border border-green-200 rounded-xl text-green-600">тЬЕ р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╣Ар╕гр╕╡р╕вр╕Ъя┐╜я┐╜я┐╜р╣Йр╕нр╕в! р╕гр╕нр╕Бр╕▓р╕гр╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Ир╕▓р╕Бр╕Др╕гр╕╣</div>';
        
        // Reset form
        document.getElementById('formName').value = '';
        document.getElementById('formClass').value = '';
        document.getElementById('formReason').value = '';
        document.getElementById('formReasonDetail').value = '';
        document.getElementById('formTimeReturn').value = '';
        uploadedImage = '';
        document.getElementById('imagePreview').classList.add('hidden');
        document.getElementById('formImage').value = '';
        
        // Notify teachers
        lastPendingCount = allRecords.filter(r => r.status === 'pending').length;
        showToast('р╕кр╣Ир╕Зр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в', 'р╕Др╕гр╕╣р╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щр╣Бр╕ер╣Йр╕з');
      } catch (err) {
        messageEl.innerHTML = '<div class="p-4 bg-red-50 border border-red-200 rounded-xl text-red-600">тЭМ р╣Ар╕Бр╕┤р╕Фр╕Вр╣Йр╕нр╕Ьр╕┤р╕Фр╕Юр╕ер╕▓р╕Ф р╕Бр╕гр╕╕р╕Ур╕▓р╕ер╕нр╕Зр╣Гр╕лр╕бр╣И</div>';
        console.error('Submit error:', err);
      }
      
      submitBtn.disabled = false;
      submitBtn.innerHTML = 'тЬи р╕кр╣Ир╕Зр╕Др╕│р╕Вр╕нр╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ';
      messageEl.classList.remove('hidden');
      
      setTimeout(() => messageEl.classList.add('hidden'), 5000);
    }
    
    // Update student history
    function updateStudentHistory() {
      const listEl = document.getElementById('studentHistoryList');
      if (!listEl || !currentUser) return;
      
      const myRecords = allRecords.filter(r => r.student_id === currentUser.studentId);
      
      if (myRecords.length === 0) {
        listEl.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <div class="text-5xl mb-2">ЁЯУн</div>
            <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕нр╕ер╕▓</p>
          </div>
        `;
        return;
      }
      
      listEl.innerHTML = myRecords.map(r => `
        <div class="p-4 bg-white rounded-xl border-2 ${getStatusBorderColor(r.status)} transition-all hover:shadow-md">
          <div class="flex items-start justify-between gap-4 flex-wrap">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-2">
                <span class="px-3 py-1 rounded-full text-white text-xs font-medium ${getStatusClass(r.status)}">
                  ${getStatusText(r.status)}
                </span>
                <span class="text-sm text-gray-500">ЁЯУЕ ${formatDate(r.leave_date)}</span>
              </div>
              <p class="font-medium text-gray-800">${escapeHtml(r.student_name)} (${escapeHtml(r.class_room)})</p>
              <p class="text-sm text-gray-600">ЁЯХР р╣Ар╕зр╕ер╕▓р╕нр╕нр╕Б: ${r.leave_time}${r.return_time ? ` | р╣Ар╕зр╕ер╕▓р╕Бр╕ер╕▒р╕Ъ: ${r.return_time}` : ''}</p>
              <p class="text-sm text-gray-600">ЁЯУЛ ${escapeHtml(r.reason)}</p>
              ${r.status === 'rejected' && r.reject_note ? `<p class="text-sm text-red-500 mt-1">тЭМ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕: ${escapeHtml(r.reject_note)}</p>` : ''}
              ${r.status === 'approved' ? `<p class="text-sm text-green-500 mt-1">тЬЕ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Вр╕Фр╕в: ${escapeHtml(r.approved_by || 'р╕Др╕гр╕╣')}</p>` : ''}
            </div>
            ${r.parent_image ? `
              <img src="${r.parent_image}" class="w-16 h-16 object-cover rounded-lg cursor-pointer hover:opacity-80 transition-all" 
                onclick="showImage('${r.parent_image.replace(/'/g, "\\'")}')" alt="р╕гр╕╣р╕Ыр╕Ьр╕╣р╣Йр╕Ыр╕Бр╕Др╕гр╕нр╕З">
            ` : ''}
          </div>
        </div>
      `).join('');
    }
    
    // Update pending list
    function updatePendingList() {
      const listEl = document.getElementById('pendingList');
      if (!listEl) return;
      
      const pendingRecords = allRecords.filter(r => r.status === 'pending');
      
      if (pendingRecords.length === 0) {
        listEl.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <div class="text-5xl mb-2">тЬЕ</div>
            <p>р╣Др╕бр╣Ир╕бр╕╡р╕Др╕│р╕Вр╕нр╕Чр╕╡р╣Ир╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</p>
          </div>
        `;
        return;
      }
      
      listEl.innerHTML = pendingRecords.map(r => createTeacherCard(r, true)).join('');
    }
    
    // Update all list
    function updateAllList() {
      const listEl = document.getElementById('allList');
      if (!listEl) return;
      
      if (allRecords.length === 0) {
        listEl.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <div class="text-5xl mb-2">ЁЯУн</div>
            <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е</p>
          </div>
        `;
        return;
      }
      
      const sorted = [...allRecords].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));
      listEl.innerHTML = sorted.map(r => createTeacherCard(r, false)).join('');
    }
    
    // Create teacher card
    function createTeacherCard(r, showActions) {
      return `
        <div class="p-4 bg-white rounded-xl border-2 ${getStatusBorderColor(r.status)} transition-all hover:shadow-md">
          <div class="flex items-start gap-4 flex-wrap">
            ${r.parent_image ? `
              <img src="${r.parent_image}" class="w-20 h-20 object-cover rounded-xl cursor-pointer hover:opacity-80 transition-all flex-shrink-0" 
                onclick="showImage('${r.parent_image.replace(/'/g, "\\'")}')" alt="р╕гр╕╣р╕Ыр╕Ьр╕╣р╣Йр╕Ыр╕Бр╕Др╕гр╕нр╕З">
            ` : '<div class="w-20 h-20 bg-gray-100 rounded-xl flex items-center justify-center text-3xl flex-shrink-0">ЁЯСд</div>'}
            
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-2 flex-wrap">
                <span class="px-3 py-1 rounded-full text-white text-xs font-medium ${getStatusClass(r.status)}">
                  ${getStatusText(r.status)}
                </span>
                <span class="text-sm text-gray-500">ЁЯУЕ ${formatDate(r.leave_date)}</span>
                <span class="text-sm text-gray-400">ЁЯХР ${formatTime(r.created_at)}</span>
              </div>
              <p class="font-semibold text-gray-800 text-lg">${escapeHtml(r.student_name)}</p>
              <p class="text-sm text-gray-600">ЁЯОл р╕гр╕лр╕▒р╕к: ${escapeHtml(r.student_id)} | ЁЯПл р╕лр╣Йр╕нр╕З: ${escapeHtml(r.class_room)}</p>
              <p class="text-sm text-gray-600">ЁЯХР р╣Ар╕зр╕ер╕▓р╕нр╕нр╕Б: ${r.leave_time}${r.return_time ? ` | р╣Ар╕зр╕ер╕▓р╕Бр╕ер╕▒р╕Ъ: ${r.return_time}` : ' | р╣Др╕бр╣Ир╕Бр╕ер╕▒р╕Ъ'}</p>
              <p class="text-sm text-gray-700 mt-1">ЁЯУЛ <span class="font-medium">${escapeHtml(r.reason)}</span></p>
              ${r.status === 'rejected' && r.reject_note ? `<p class="text-sm text-red-500 mt-1">тЭМ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕: ${escapeHtml(r.reject_note)}</p>` : ''}
              ${r.status === 'approved' ? `<p class="text-sm text-green-500 mt-1">тЬЕ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Вр╕Фр╕в: ${escapeHtml(r.approved_by || 'р╕Др╕гр╕╣')} | ${formatTime(r.approved_at)}</p>` : ''}
            </div>
            
            ${showActions ? `
              <div class="flex gap-2 flex-shrink-0">
                <button onclick="approveRequest('${r.id}')" 
                  class="px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-all font-medium">
                  тЬЕ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
                </button>
                <button onclick="showRejectModal('${r.id}')" 
                  class="px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-all font-medium">
                  тЭМ р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
                </button>
              </div>
            ` : ''}
          </div>
        </div>
      `;
    }
    
    // Search
    function performSearch() {
      const searchName = document.getElementById('searchName').value.toLowerCase().trim();
      const searchDate = document.getElementById('searchDate').value;
      const searchStatus = document.getElementById('searchStatus').value;
      const resultsEl = document.getElementById('searchResults');
      
      if (!resultsEl) return;
      
      let filtered = [...allRecords];
      
      if (searchName) {
        filtered = filtered.filter(r => 
          r.student_name.toLowerCase().includes(searchName) || 
          r.student_id.toLowerCase().includes(searchName)
        );
      }
      
      if (searchDate) {
        filtered = filtered.filter(r => r.leave_date === searchDate);
      }
      
      if (searchStatus) {
        filtered = filtered.filter(r => r.status === searchStatus);
      }
      
      if (filtered.length === 0) {
        resultsEl.innerHTML = `
          <div class="text-center py-8 text-gray-400">
            <div class="text-5xl mb-2">ЁЯФН</div>
            <p>р╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Чр╕╡р╣Ир╕Др╣Йр╕Щр╕лр╕▓</p>
          </div>
        `;
        return;
      }
      
      resultsEl.innerHTML = filtered.map(r => createTeacherCard(r, r.status === 'pending')).join('');
    }
    
    // Approve request
    function approveRequest(id) {
      const index = allRecords.findIndex(r => r.id === id);
      if (index === -1) return;
      
      allRecords[index].status = 'approved';
      allRecords[index].approved_at = new Date().toISOString();
      allRecords[index].approved_by = 'р╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░я┐╜я┐╜я┐╜р╕Ъ';
      
      saveRecords();
      updateUI();
      showToast('р╕кр╕│р╣Ар╕гр╣Зр╕И!', 'р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕нр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕вр╣Бр╕ер╣Йр╕з');
    }
    
    // Show reject modal
    function showRejectModal(id) {
      pendingRejectId = id;
      document.getElementById('rejectNote').value = '';
      document.getElementById('rejectModal').classList.remove('hidden');
    }
    
    // Close reject modal
    function closeRejectModal() {
      pendingRejectId = null;
      document.getElementById('rejectModal').classList.add('hidden');
    }
    
    // Confirm reject
    function confirmReject() {
      if (!pendingRejectId) return;
      
      const note = document.getElementById('rejectNote').value.trim();
      if (!note) {
        document.getElementById('rejectNote').style.borderColor = '#f87171';
        return;
      }
      
      const index = allRecords.findIndex(r => r.id === pendingRejectId);
      if (index === -1) return;
      
      allRecords[index].status = 'rejected';
      allRecords[index].reject_note = note;
      allRecords[index].approved_at = new Date().toISOString();
      allRecords[index].approved_by = 'р╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ';
      
      saveRecords();
      updateUI();
      showToast('р╕Ър╕▒р╕Щр╕Чр╕╢р╕Бр╣Бр╕ер╣Йр╕з', 'р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕нр╣Ар╕гр╕╡р╕вр╕Ър╕гр╣Йр╕нр╕в');
      closeRejectModal();
    }
    
    // Show image modal
    function showImage(src) {
      const modal = document.getElementById('imageModal');
      const img = document.getElementById('modalImage');
      if (modal && img) {
        img.src = src;
        modal.classList.remove('hidden');
      }
    }
    
    // Close image modal
    function closeImageModal() {
      document.getElementById('imageModal').classList.add('hidden');
    }
    
    // Utility functions
    function getStatusClass(status) {
      switch (status) {
        case 'pending': return 'status-pending';
        case 'approved': return 'status-approved';
        case 'rejected': return 'status-rejected';
        default: return 'bg-gray-500';
      }
    }
    
    function getStatusBorderColor(status) {
      switch (status) {
        case 'pending': return 'border-yellow-200';
        case 'approved': return 'border-green-200';
        case 'rejected': return 'border-red-200';
        default: return 'border-gray-200';
      }
    }
    
    function getStatusText(status) {
      switch (status) {
        case 'pending': return 'тП│ р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г';
        case 'approved': return 'тЬЕ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Бр╕ер╣Йр╕з';
        case 'rejected': return 'тЭМ р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤';
        default: return status;
      }
    }
    
    function formatDate(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      return date.toLocaleDateString('th-TH', { day: 'numeric', month: 'short', year: 'numeric' });
    }
    
    function formatTime(dateStr) {
      if (!dateStr) return '-';
      const date = new Date(dateStr);
      return date.toLocaleTimeString('th-TH', { hour: '2-digit', minute: '2-digit' });
    }
    
    function escapeHtml(str) {
      if (!str) return '';
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }
    
    // Initialize on load
    initApp();
  </script>
</body>
</html>
5xl mb-2">ЁЯУн</div>
              <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Ыр╕гр╕░р╕зр╕▒р╕Хр╕┤р╕Бр╕▓р╕гр╕Вр╕нр╕ер╕▓</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Teacher Dashboard -->
    <div id="teacherDashboard" class="min-h-full w-full p-4 relative z-10 hidden">
      <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <div class="glass-card rounded-2xl p-4 mb-4 cute-shadow">
          <div class="flex items-center justify-between flex-wrap gap-4">
            <div class="flex items-center gap-3">
              <div class="text-4xl wiggle-animation">ЁЯСитАНЁЯПл</div>
              <div>
                <p class="font-semibold text-gray-800">р╕гр╕░р╕Ър╕Ър╕лр╕ер╕▒р╕Зр╕Ър╣Йр╕▓р╕Щ</p>
                <p class="text-sm text-gray-500">р╕Ьр╕╣р╣Йр╕Фр╕╣р╣Бр╕ер╕гр╕░р╕Ър╕Ъ</p>
              </div>
            </div>
            <div class="flex items-center gap-3">
              <div id="notificationBell" class="relative cursor-pointer p-2 hover:bg-gray-100 rounded-full transition-all">
                <span class="text-2xl">ЁЯФФ</span>
                <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-500 text-white text-xs w-5 h-5 rounded-full flex items-center justify-center font-bold hidden">0</span>
              </div>
              <button type="button" onclick="logout()" class="px-4 py-2 bg-red-100 text-red-600 rounded-xl hover:bg-red-200 transition-all text-sm font-medium">
                ЁЯЪк р╕нр╕нр╕Бр╕Ир╕▓р╕Бр╕гр╕░р╕Ър╕Ъ
              </button>
            </div>
          </div>
        </div>
        
        <!-- Stats -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-yellow-100 rounded-xl flex items-center justify-center text-2xl">тП│</div>
              <div>
                <p class="text-2xl font-bold text-yellow-600" id="statPending">0</p>
                <p class="text-xs text-gray-500">р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</p>
              </div>
            </div>
          </div>
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center text-2xl">тЬЕ</div>
              <div>
                <p class="text-2xl font-bold text-green-600" id="statApproved">0</p>
                <p class="text-xs text-gray-500">р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Бр╕ер╣Йр╕з</p>
              </div>
            </div>
          </div>
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center text-2xl">тЭМ</div>
              <div>
                <p class="text-2xl font-bold text-red-600" id="statRejected">0</p>
                <p class="text-xs text-gray-500">р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</p>
              </div>
            </div>
          </div>
          <div class="glass-card rounded-2xl p-4 cute-shadow">
            <div class="flex items-center gap-3">
              <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center text-2xl">ЁЯУК</div>
              <div>
                <p class="text-2xl font-bold text-blue-600" id="statTotal">0</p>
                <p class="text-xs text-gray-500">р╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</p>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Teacher Tabs -->
        <div class="glass-card rounded-2xl p-2 mb-4 cute-shadow">
          <div class="flex gap-2 flex-wrap">
            <button type="button" onclick="showTeacherTab('pending')" id="teacherTabPending" 
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gradient-to-r from-green-500 to-teal-500 text-white min-w-fit">
              тП│ р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕Др╕│р╕Вр╕н
            </button>
            <button type="button" onclick="showTeacherTab('all')" id="teacherTabAll"
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200 min-w-fit">
              ЁЯУЛ р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф
            </button>
            <button type="button" onclick="showTeacherTab('search')" id="teacherTabSearch"
              class="flex-1 py-3 px-4 rounded-xl font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200 min-w-fit">
              ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓
            </button>
          </div>
        </div>
        
        <!-- Pending Requests -->
        <div id="pendingSection" class="glass-card rounded-2xl p-6 cute-shadow">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl wiggle-animation">тП│</span>
            <h2 class="text-xl font-bold text-gray-800">р╕Др╕│р╕Вр╕нр╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</h2>
          </div>
          <div id="pendingList" class="space-y-4">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯУн</div>
              <p>р╣Др╕бр╣Ир╕бр╕╡р╕Др╕│р╕Вр╕нр╕Чр╕╡р╣Ир╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</p>
            </div>
          </div>
        </div>
        
        <!-- All Records -->
        <div id="allSection" class="glass-card rounded-2xl p-6 cute-shadow hidden">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl bounce-animation">ЁЯУЛ</span>
            <h2 class="text-xl font-bold text-gray-800">р╕гр╕▓р╕вр╕Бр╕▓р╕гр╕Чр╕▒р╣Йр╕Зр╕лр╕бр╕Ф</h2>
          </div>
          <div id="allList" class="space-y-4">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯУн</div>
              <p>р╕вр╕▒р╕Зр╣Др╕бр╣Ир╕бр╕╡р╕Вр╣Йр╕нр╕бр╕╣р╕е</p>
            </div>
          </div>
        </div>
        
        <!-- Search Section -->
        <div id="searchSection" class="glass-card rounded-2xl p-6 cute-shadow hidden">
          <div class="flex items-center gap-2 mb-6">
            <span class="text-3xl bounce-animation">ЁЯФН</span>
            <h2 class="text-xl font-bold text-gray-800">р╕Др╣Йр╕Щр╕лр╕▓р╕Вр╣Йр╕нр╕бр╕╣р╕е</h2>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
            <input type="text" id="searchName" placeholder="ЁЯФН р╕Др╣Йр╕Щр╕лр╕▓р╕Кр╕╖р╣Ир╕н/р╕гр╕лр╕▒р╕кр╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ"
              class="px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all"
              oninput="performSearch()">
            <input type="date" id="searchDate"
              class="px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all"
              onchange="performSearch()">
            <select id="searchStatus" class="px-4 py-3 border-2 border-green-100 rounded-xl focus:border-green-400 transition-all"
              onchange="performSearch()">
              <option value="">-- р╕Чр╕╕р╕Бр╕кр╕Цр╕▓р╕Щр╕░ --</option>
              <option value="pending">тП│ р╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г</option>
              <option value="approved">тЬЕ р╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╣Бр╕ер╣Йр╕з</option>
              <option value="rejected">тЭМ р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</option>
            </select>
          </div>
          <div id="searchResults" class="space-y-4">
            <div class="text-center py-8 text-gray-400">
              <div class="text-5xl mb-2">ЁЯФН</div>
              <p>р╕Юр╕┤р╕бр╕Юр╣Мр╣Ар╕Юр╕╖р╣Ир╕нр╕Др╣Йр╕Щр╕лр╕▓</p>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Reject Modal -->
    <div id="rejectModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden p-4">
      <div class="bg-white rounded-2xl p-6 w-full max-w-md cute-shadow">
        <div class="text-center mb-4">
          <div class="text-5xl mb-2">тЭМ</div>
          <h3 class="text-xl font-bold text-gray-800">р╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤р╕Др╕│р╕Вр╕н</h3>
        </div>
        <div class="mb-4">
          <label class="block text-sm font-medium text-gray-700 mb-2">ЁЯУЭ р╕лр╕бр╕▓р╕вр╣Ар╕лр╕Хр╕╕р╕Бр╕▓р╕гр╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤</label>
          <textarea id="rejectNote" rows="3" placeholder="р╕Бр╕гр╕╕р╕Ур╕▓р╕гр╕░р╕Ър╕╕р╣Ар╕лр╕Хр╕╕р╕Ьр╕е..."
            class="w-full px-4 py-3 border-2 border-red-100 rounded-xl focus:border-red-400 transition-all resize-none"></textarea>
        </div>
        <div class="flex gap-3">
          <button type="button" onclick="closeRejectModal()" 
            class="flex-1 py-3 bg-gray-100 text-gray-600 rounded-xl font-medium hover:bg-gray-200 transition-all">
            р╕вр╕Бр╣Ар╕ер╕┤р╕Б
          </button>
          <button type="button" onclick="confirmReject()" 
            class="flex-1 py-3 bg-red-500 text-white rounded-xl font-medium hover:bg-red-600 transition-all">
            тЭМ р╕вр╕╖р╕Щр╕вр╕▒р╕Щр╣Др╕бр╣Ир╕нр╕Щр╕╕р╕бр╕▒р╕Хр╕┤
          </button>
        </div>
      </div>
    </div>
    
    <!-- Image Modal -->
    <div id="imageModal" class="fixed inset-0 bg-black/80 flex items-center justify-center z-50 hidden p-4" onclick="closeImageModal()">
      <div class="max-w-2xl max-h-[80%] overflow-hidden">
        <img id="modalImage" class="max-w-full max-h-full rounded-xl shadow-2xl">
      </div>
    </div>
    
    <!-- Notification Toast -->
    <div id="toast" class="fixed top-4 right-4 bg-green-500 text-white px-6 py-4 rounded-xl shadow-lg z-50 hidden transform translate-x-full transition-transform">
      <div class="flex items-center gap-3">
        <span class="text-2xl">ЁЯФФ</span>
        <div>
          <p class="font-semibold" id="toastTitle">р╣Бр╕Ир╣Йр╕Зр╣Ар╕Хр╕╖р╕нр╕Щ</p>
          <p class="text-sm opacity-90" id="toastMessage">р╕бр╕╡р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣И</p>
        </div>
      </div>
    </div>
    
  </div>

  <script>
    // Global State
    let currentUser = null;
    let userType = null;
    let allRecords = [];
    let pendingRejectId = null;
    let lastPendingCount = 0;
    
    const defaultConfig = {
      school_name: 'р╕гр╕░р╕Ър╕Ър╕ер╕▓р╕Бр╕ер╕▒р╕Ър╕Ър╣Йр╕▓р╕Щ'
    };
    
    // LocalStorage Keys
    const STORAGE_KEY = 'leaveRecords';
    
    // Initialize
    async function initApp() {
      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const schoolName = config.school_name || defaultConfig.school_name;
            const el = document.getElementById('schoolNameDisplay');
            if (el) el.textContent = schoolName;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined
          }),
          mapToEditPanelValues: (config) => new Map([
            ['school_name', config.school_name || defaultConfig.school_name]
          ])
        });
      }
      
      // Load records from localStorage
      loadRecords();
      
      // Set default date/time
      const today = new Date();
      const dateInput = document.getElementById('formDate');
      if (dateInput) {
        dateInput.value = today.toISOString().split('T')[0];
      }
      
      const timeInput = document.getElementById('formTimeOut');
      if (timeInput) {
        timeInput.value = today.toTimeString().slice(0, 5);
      }
    }
    
    // Load records from localStorage
    function loadRecords() {
      try {
        const stored = localStorage.getItem(STORAGE_KEY);
        allRecords = stored ? JSON.parse(stored) : [];
      } catch (err) {
        console.error('Failed to load records:', err);
        allRecords = [];
      }
    }
    
    // Save records to localStorage
    function saveRecords() {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(allRecords));
      } catch (err) {
        console.error('Failed to save records:', err);
      }
    }
    
    // Check for new notifications (for teachers)
    function checkNotifications() {
      if (userType !== 'teacher') return;
      
      const pendingCount = allRecords.filter(r => r.status === 'pending').length;
      
      if (pendingCount > lastPendingCount && lastPendingCount > 0) {
        showToast('р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣И!', `р╕бр╕╡ ${pendingCount - lastPendingCount} р╕Др╕│р╕Вр╕нр╣Гр╕лр╕бр╣Ир╕гр╕нр╕Фр╕│р╣Ар╕Щр╕┤р╕Щр╕Бр╕▓р╕г`);
      }
      
      lastPendingCount = pendingCount;
      
      // Update notification badge
      const countEl = document.getElementById('notificationCount');
      if (countEl) {
        if (pendingCount > 0) {
          countEl.textContent = pendingCount;
          countEl.classList.remove('hidden');
        } else {
          countEl.classList.add('hidden');
        }
      }
    }
    
    // Show toast notification
    function showToast(title, message) {
      const toast = document.getElementById('toast');
      const toastTitle = document.getElementById('toastTitle');
      const toastMessage = document.getElementById('toastMessage');
      
      if (toast && toastTitle && toastMessage) {
        toastTitle.textContent = title;
        toastMessage.textContent = message;
        toast.classList.remove('hidden', 'translate-x-full');
        
        setTimeout(() => {
          toast.classList.add('translate-x-full');
          setTimeout(() => toast.classList.add('hidden'), 300);
        }, 4000);
      }
    }
    
    // Update all UI elements
    function updateUI() {
      updateStats();
      
      if (userType === 'student' && currentUser) {
        updateStudentHistory();
      } else if (userType === 'teacher') {
        updatePendingList();
        updateAllList();
        performSearch();
      }
      
      checkNotifications();
    }
    
    // Update stats
    function updateStats() {
      const pending = allRecords.filter(r => r.status === 'pending').length;
      const approved = allRecords.filter(r => r.status === 'approved').length;
      const rejected = allRecords.filter(r => r.status === 'rejected').length;
      
      const statPending = document.getElementById('statPending');
      const statApproved = document.getElementById('statApproved');
      const statRejected = document.getElementById('statRejected');
      const statTotal = document.getElementById('statTotal');
      
      if (statPending) statPending.textContent = pending;
      if (statApproved) statApproved.textContent = approved;
      if (statRejected) statRejected.textContent = rejected;
      if (statTotal) statTotal.textContent = allRecords.length;
    }
    
    // Student login
    function studentLogin() {
      const studentId = document.getElementById('studentIdInput')?.value?.trim();
      const nationalId = document.getElementById('nationalIdInput')?.value?.trim();
      const errorEl = document.getElementById('loginError');
      
      if (!studentId || !nationalId || nationalId.length !== 4) {
        if (errorEl) {
          errorEl.textContent = 'тЭМ р╕Бр╕гр╕╕р╕Ур╕▓р╕Бр╕гр╕нр╕Бр╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Ир╕│р╕Хр╕▒р╕зр╣Бр╕ер╕░р╣Ар╕ер╕Вр╕Ыр╕гр╕░р╕Кр╕▓р╕Кр╕Щ 4 р╕Хр╕▒р╕зр╕Чр╣Йр╕▓р╕в';
          errorEl.classList.remove('hidden');
        }
        return;
      }
      
      currentUser = { studentId, nationalId };
      userType = 'student';
      
      const loginPageEl = document.getElementById('loginPage');
      const dashboardEl = document.getElementById('studentDashboard');
      
      if (loginPageEl) loginPageEl.classList.add('hidden');
      if (dashboardEl) dashboardEl.classList.remove('hidden');
      
      const welcomeEl = document.getElementById('welcomeStudent');
      const idEl = document.getElementById('studentIdDisplay');
      
      if (welcomeEl) welcomeEl.textContent = `р╕вр╕┤р╕Щр╕Фр╕╡р╕Хр╣Йр╕нр╕Щр╕гр╕▒р╕Ъ р╕Щр╕▒р╕Бр╣Ар╕гр╕╡р╕вр╕Щ`;
      if (idEl) idEl.textContent = `р╕гр╕лр╕▒р╕к: ${studentId}`;
      
      updateUI();
    }
    
    // Teacher login
    function teacherLogin() {
      const username = document.getElementById('teacherUsername')?.value?.trim();
      const password = document.getElementById('teacherPassword')?.value?.trim();
      const errorEl = document.getElementById('teacherLoginError');
      
      if (username === 'admin' && password === '1234') {
        currentUser = { username };
        userType = 'teacher';
        lastPendingCount = allRecords.filter(r => r.status === 'pending').length;
        
        const teacherLoginEl = document.getElementById('teacherLoginPage');
        const teacherDashEl = document.getElementById('teacherDashboard');
        
        if (teacherLoginEl) teacherLoginEl.classList.add('hidden');
        if (teacherDashEl) teacherDashEl.classList.remove('hidden');
        
        updateUI();
      } else {
        if (errorEl) {
          errorEl.classList.remove('hidden');
        }
      }
    }
    
    // Show teacher login
    function showTeacherLogin() {
      const loginPageEl = document.getElementById('loginPage');
      const teacherLoginEl = document.getElementById('teacherLoginPage');
      
      if (loginPageEl) loginPageEl.classList.add('hidden');
      if (teacherLoginEl) teacherLoginEl.classList.remove('hidden');
    }
    
    // Show student login
    function showStudentLogin() {
      const teacherLoginEl = document.getElementById('teacherLoginPage');
      const logi
